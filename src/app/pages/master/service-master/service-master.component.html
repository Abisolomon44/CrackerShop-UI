<div class="container mt-5">
  <div class="row g-4">
    <!-- Service Form -->
    <div class="col-12">
      <div class="form-container p-4 rounded shadow-sm bg-light">
        <h2>Service Master</h2>
        <form #serviceForm="ngForm">
          <!-- Row 1: Code, Name, Charge -->
          <div class="form-row-three">
            <div class="form-column">
              <label for="serviceCode">Code</label>
              <input
                type="text"
                id="serviceCode"
                class="form-control"
                [(ngModel)]="service.serviceCode"
                name="serviceCode"
                readonly
                appInputRestrict="text"
                appFocusOnKey
                targetId="serviceName"
              />
            </div>

            <div class="form-column">
              <label for="serviceName" class="required">Name</label>
              <input
                type="text"
                id="serviceName"
                class="form-control"
                [(ngModel)]="service.serviceName"
                name="serviceName"
                required
                appInputRestrict="letter"
                appFocusOnKey
                targetId="serviceCharge"
                (ngModelChange)="checkDuplicate()"
              />
              <small *ngIf="duplicateError" class="text-danger">
                Service Name already exists!
              </small>
            </div>

            <div class="form-column">
              <label for="serviceCharge">Charge</label>
              <input
                type="text"
                id="serviceCharge"
                class="form-control"
                [(ngModel)]="service.serviceCharge"
                name="serviceCharge"
                appInputRestrict="number"
                appFocusOnKey
                targetId="categoryID"
              />
            </div>
          </div>

          <!-- Row 2: Category, HSN, Tax, Cess -->
          <div class="form-row-three mt-2">
            <div class="form-column">
              <label for="categoryID">Category</label>
              <select
                id="categoryID"
                class="form-select"
                [(ngModel)]="service.categoryID"
                name="categoryID"
                appFocusOnKey
                targetId="hsnid"
              >
                <option [ngValue]="0">--Select--</option>
                <option *ngFor="let c of categories" [ngValue]="c.categoryID">
                  {{ c.categoryName }}
                </option>
              </select>
            </div>

            <div class="form-column">
              <label for="hsnid">HSN</label>
              <select
                id="hsnid"
                class="form-select"
                [(ngModel)]="service.hsnid"
                name="hsnid"
                appFocusOnKey
                targetId="taxID"
              >
                <option [ngValue]="0">--Select--</option>
                <option *ngFor="let h of hsnCodes" [ngValue]="h.hsnCode">
                  {{ h.hsnCode }}
                </option>
              </select>
            </div>

            <div class="form-column">
              <label for="taxID">Tax</label>
              <select
                id="taxID"
                class="form-select"
                [(ngModel)]="service.taxID"
                name="taxID"
                appFocusOnKey
                targetId="cessID"
              >
                <option [ngValue]="0">--Select--</option>
                <option *ngFor="let t of taxes" [ngValue]="t.taxID">
                  {{ t.taxName }}
                </option>
              </select>
            </div>

            <div class="form-column">
              <label for="cessID">Cess</label>
              <select
                id="cessID"
                class="form-select"
                [(ngModel)]="service.cessID"
                name="cessID"
                appFocusOnKey
                targetId="isActive"
              >
                <option [ngValue]="0">--Select--</option>
                <option *ngFor="let c of cesses" [ngValue]="c.cessID">
                  {{ c.cessName }}
                </option>
              </select>
            </div>
          </div>

          <!-- Row 3: Active & Save -->
          <div class="form-row-three align-items-center mt-2">
            <div class="form-column d-flex align-items-center">
              <input
                type="checkbox"
                id="isActive"
                [(ngModel)]="service.isActive"
                name="isActive"
                appFocusOnKey
                targetId="saveBtn"
              />
              <label for="isActive">Active</label>
            </div>

            <div class="form-column">
              <button
                type="button"
                id="saveBtn"
                class="btn btn-primary w-100"
                (click)="saveOrUpdateService()"
                [disabled]="serviceForm.invalid || duplicateError"
              >
                {{ service.serviceID ? "Update" : "Save" }}
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- Service Table -->
    <div class="col-12 mt-4">
      <div class="table-container">
        <table class="table table-bordered table-hover table-common">
          <thead>
            <tr>
              <th>#</th>
              <th>Code</th>
              <th>Name</th>
              <th>Charge</th>
              <th>Category</th>
              <th>HSN</th>
              <th>Tax</th>
              <th>Cess</th>
              <th>Status</th>
              <th class="text-center">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let s of services; let i = index"
              [class.table-warning]="service.serviceID === s.serviceID"
            >
              <td>{{ i + 1 }}</td>
              <td>{{ s.serviceCode }}</td>
              <td>{{ s.serviceName }}</td>
              <td>{{ s.serviceCharge }}</td>
              <td>{{ getCategoryName(s.categoryID) }}</td>
              <td>{{ getHSNCode(s.hsnid) }}</td>
              <td>{{ getTaxName(s.taxID) }}</td>
              <td>{{ getCessName(s.cessID) }}</td>

              <td>
                <span
                  class="badge"
                  [ngClass]="s.isActive ? 'bg-success' : 'bg-danger'"
                  >{{ s.isActive ? "Active" : "Inactive" }}</span
                >
              </td>
              <td class="text-center">
                <button
                  class="btn btn-sm btn-primary me-1"
                  (click)="editService(s)"
                >
                  <i class="bi bi-pencil-fill"></i>
                </button>
                <button
                  class="btn btn-sm btn-danger"
                  (click)="deleteService(s)"
                >
                  <i class="bi bi-trash-fill"></i>
                </button>
              </td>
            </tr>
            <tr *ngIf="services.length === 0">
              <td colspan="10" class="text-center text-muted">
                No services found.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
